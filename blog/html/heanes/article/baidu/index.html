<!DOCTYPE html>
<html>
<head>
    <title>文章-仿百度百科</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="css/baidu.css">
    <style>
        *{ margin:0; padding:0 }
        .wrap{width:1130px; overflow:hidden; margin:0 auto }
        .content{float:left }
    </style>
</head>
<body>
<div class="wrap">
    <div class="content">
        <div class="main-content" id="mainContent">
            <!--<div class="anchor-list">
                <a name="1" class="lemma-anchor para-title anchor-address"></a>
                <a name="sub1001_1" class="lemma-anchor-address"></a>
                <a name="第一章" class="lemma-anchor anchor-name"></a>
            </div>-->
            <div class="para-title level-2">
                <h2 class="title-text">第一章</h2>
            </div>
            <div class="para">
                <div class="placeholder ph-large">内容</div>
            </div>
            <div class="para-title level-2">
                <h2 class="title-text">第二章</h2>
            </div>
            <div class="para">
                <div class="placeholder ph-mini"></div>
            </div>
            <div class="para-title level-3">
                <h3 class="title-text">第二章第一节</h3>
            </div>
            <div class="para">
                <div class="placeholder ph-large">内容</div>
            </div>
            <div class="para-title level-3">
                <h3 class="title-text">第二章第二节</h3>
            </div>
            <div class="para">
                <div class="placeholder ph-large">内容</div>
            </div>
            <div class="para-title level-2">
                <h2 class="title-text">第三章</h2>
            </div>
            <div class="para">
                <div class="placeholder ph-large">内容</div>
            </div>
            <div class="para-title level-3">
                <h3 class="title-text">第三章第一节</h3>
            </div>
            <div class="para">
                <div class="placeholder ph-large">内容</div>
            </div>
            <div class="para-title level-3">
                <h3 class="title-text">第三章第二节</h3>
            </div>
            <div class="para">
                <div class="placeholder ph-large">内容</div>
            </div>
            <div class="para-title level-3">
                <h3 class="title-text">第三章第三节</h3>
            </div>
            <div class="para">
                <div class="placeholder ph-large">内容</div>
            </div>
        </div>
        <div class="side-content">
            <div class="side-catalog" id="articleCatalog">
                <div class="side-bar">
                    <em class="circle start"></em>
                    <em class="circle end"></em>
                </div>
                <div class="catalog-scroller">
                    <dl class="catalog-list">
                        <!--<dt class="catalog-title level1">
                            <em class="pointer"></em>
                            <span class="text">
                                <span class="title-index">1</span>
                                <a href="#1" class="title-link">第一章</a>
                            </span>
                        </dt>
                        <dd class="catalog-title level2">
                            <span class="text">
                                <span class="title-index">2.1</span>
                                <a href="#2_1" class="title-link">第二章第一节</a>
                            </span>
                        </dd>-->
                        <a class="arrow" href="javascript:void(0);"></a>
                    </dl>
                </div>
                <div class="right-wrap">
                    <a class="go-up disable" href="javascript:void(0);"></a>
                    <a class="go-down" href="javascript:void(0);"></a>
                </div>
                <div class="bottom-wrap">
                    <a class="toggle-button" href="javascript:void(0);"></a>
                    <a class="gotop-button" href="javascript:void(0);"></a>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" src="/public/static/libs/js/jquery/2.2.3/jquery.min.js"></script>
<script>
    $(function() {
        /**
         * @doc 仿百度百科自动寻找文章标题
         *      根据h2~h3级别，插入anchor-list内容到文章content中
         * @author fanggang
         * @time 2016-04-08 18:25:56 周五
         */
        // 1.先找到所有h2~h3的内容
        var $content = $('#mainContent'); // 配置项1，主文章容器
        var $headerList = $content.find('h2,h3'); // 配置项2，第一级别选择器内容，可以为class选择器;配置项3，第二级别选择器内容，可以为class选择器
        var $headerListLength = $headerList.length;
        var $articleCatalog = $('#articleCatalog'); // 配置项3，导航目录放置目的地
        var $catalogList = $articleCatalog.find('.catalog-list');
        var $arrow = $('.arrow');
        var anchorList = [];
        var h2 = 1, h3 = 1, anchorAddress = '', anchorName = '', anchor = {}, level = 1, catalogStr = '';
        $.each($headerList, function (i, item) {
            // 顺序生成多级章节
            if(item.tagName.toLowerCase() == 'h2'.toLowerCase() || $(item).hasClass('h2')){
                level = 1;
                if(h3 > 1) h2++;
                anchorAddress = h2;
                h2++;
                h3 = 1;
            }
            if(item.tagName.toLowerCase() == 'h3'.toLowerCase() || $(item).hasClass('h3')){
                level = 2;
                if(h3 == 1) h2--;
                anchorAddress = h2 + '_' + h3;
                h3++;
            }
            anchorName = $(item).html().trim();
            anchor = {anchorName: anchorName,anchorAddress: anchorAddress};
            anchorList.push(anchor);
            // 2.插入锚点链接内容到相应h2~h3的节点上方
            var anchorStr = '<div class="anchor-list">'
                            + '<a name="' + anchorAddress + '" class="lemma-anchor para-title anchor-address"></a>'
                            + '<a name="sub1001_' + anchorAddress + '" class="lemma-anchor-address"></a>'
                            + '<a name="' + anchorName + '" class="lemma-anchor anchor-name"></a>'
                            + '</div>';
            $(item).before(anchorStr);
            // 3.生成导航目录
            if(level == 1){
                catalogStr = '<dt class="catalog-title level1">'
                            + '<em class="pointer"></em>'
                            + '<span class="text">'
                            + '<span class="title-index">' + anchorAddress + '</span>'
                                + '<a href="#' + anchorAddress + '" class="title-link">' + anchorName + '</a>'
                            + '</span>'
                            + '</dt>';
            }
            else if(level == 2){
                catalogStr = '<dd class="catalog-title level2">'
                        + '<em class="pointer"></em>'
                        + '<span class="text">'
                        + '<span class="title-index">' + h2 + '.' + (h3 - 1) + '</span>'
                        + '<a href="#' + anchorAddress + '" class="title-link">' + anchorName + '</a>'
                        + '</span>'
                        + '</dd>';
            }
            $articleCatalog.find('.catalog-list').append(catalogStr);
        });

        // 目录导航处点击事件滚动目录
        var step = 48; // 配置项4, 点击一次滚动高度
        var $catalogScrollerOuter = $articleCatalog.find('.catalog-scroller');
        var $catalogScrollerInner = $articleCatalog.find('.catalog-list');
        var catalogListOutHeight = $catalogScrollerOuter.height();
        var catalogListInnerHeight = $catalogScrollerInner.height();
        var enableTop = catalogListInnerHeight - catalogListOutHeight;
        // 向上
        var $goUpBtn = $('.go-up');
        $goUpBtn.on('click', function () {
            if(!$(this).hasClass('disable')){
                if (Math.abs(parseInt($catalogScrollerInner.css('top'))) >= step) {
                    $catalogScrollerInner.stop().animate({'top': '+=' + step}, 'fast');
                    $goDownBtn.removeClass('disable');
                }else{
                    $catalogScrollerInner.stop().animate({'top': '0'}, 'fast');
                    $(this).addClass('disable');
                }
            }
            return false;
        });
        // 向下
        var $goDownBtn = $('.go-down');
        $goDownBtn.on('click', function () {
            if(!$(this).hasClass('disable')){
                if (enableTop - Math.abs(parseInt($catalogScrollerInner.css('top'))) >= step) {
                    $articleCatalog.find('.catalog-list').stop().animate({'top': '-=' + step}, 'fast');
                    $goUpBtn.removeClass('disable');
                }else{
                    $catalogScrollerInner.stop().animate({'top': -enableTop}, 'fast');
                    $(this).addClass('disable');
                }
            }
            return false;
        });

        // 滚动页面，即滚动条滚动时目录随之自动滚动
        $(window).scroll(function () {
            for (var i = $headerListLength - 1; i>=0; i--) {
                if ($(this).scrollTop() >= $headerList.eq(i).offset().top - $headerList.eq(i).height()) {
                    var index = i;
                    $catalogScrollerInner.find('dd').eq(index).addClass('highlight').siblings('dd').removeClass('highlight');
                    scrollSlide($catalogScrollerInner.find('dd').eq(index), index);
                    return false;
                } else {
                    $catalogScrollerInner.find('dd').eq(0).addClass('highlight').siblings('dd').removeClass('highlight');
                }
            }
        });

        //导航的滚动，以及向上，向下按钮的显示隐藏
        function scrollSlide(that, index){
            if (index < 5) {
                $catalogScrollerInner.stop().animate({'top': '0'}, 'fast');
                $arrow.stop().animate({'top': '0'}, 'fast');
                $goDownBtn.removeClass('disable');
                $goUpBtn.addClass('disable');
            } else if (index > 11) {
                $catalogScrollerInner.stop().animate({'top': -enableTop}, 'fast');
                $arrow.stop().animate({'top': enableTop}, 'fast');
                $goDownBtn.addClass('disable');
                $goUpBtn.removeClass('disable');
            } else {
                var dlTop = parseInt($catalogScrollerInner.css('top')) + catalogListOutHeight / 2 - (that.offset().top - $articleCatalog.offset().top);
                $catalogScrollerInner.stop().animate({'top': dlTop}, 'fast');
                $arrow.stop().stop().animate({'top': dlTop}, 'fast');
                $goDownBtn.removeClass('disable');
                $goUpBtn.removeClass('disable');
            }
        }

        // 导航侧栏内容的显示与隐藏
        $('.toggle-button').on('click', function(){
            if($articleCatalog.hasClass('collapse')){
                $articleCatalog.removeClass('collapse');
            }else{
                $articleCatalog.addClass('collapse');
            }
        });
    });
</script>
</body>
</html>